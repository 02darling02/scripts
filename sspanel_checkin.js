/**
 * SSPANEL面板签到
 *
 * @author Telegram@sudojia
 * @site https://blog.imzjw.cn
 */
const $=new require("./env").Env("SSPANEL面板自动签到"),notify=$.isNode()?require("./sendNotify"):"";let accounts=$.isNode()?process.env.ACCOUNTS?process.env.ACCOUNTS:"":$.getdata("ACCOUNTS")?$.getdata("ACCOUNTS"):"",apis=$.isNode()?process.env.SITE_URL?process.env.SITE_URL:"":$.getdata("SITE_URL")?$.getdata("SITE_URL"):"",accountList=[],apiList=[],message="";async function main(){await login(),await $.wait(2e3),await checkin()}function sendMsg(){return new Promise((async e=>{if(message)return await notify.sendNotify(`${$.name}`,`${message}`),void e();e()}))}function checkin(){return console.log("开始进行签到...\n"),new Promise((e=>{$.post(sendPost("user/checkin",""),((n,s,t)=>{try{n?console.log(`${JSON.stringify(n)}\n签到 API 请求失败，请检查网路重试`):(t=JSON.parse(t),message+=`第【${$.index}】个网站\n`,1===t.ret?t.trafficInfo?(console.log(`签到${t.msg}\n【今日已用】${t.trafficInfo.todayUsedTraffic}\n【过去已用】${t.trafficInfo.lastUsedTraffic}\n【剩余流量】${t.trafficInfo.unUsedTraffic}\n`),message+=`签到${t.msg}\n\n【今日已用】${t.trafficInfo.todayUsedTraffic}\n【过去已用】${t.trafficInfo.lastUsedTraffic}\n【剩余流量】${t.trafficInfo.unUsedTraffic}\n`):(console.log(`签到${t.msg}\n`),message+=`签到${t.msg}\n\n`):(console.log(t.msg,"\n"),message+=t.msg+"\n\n"))}catch(e){$.logErr(e,resp)}finally{e()}}))}))}function login(){return new Promise((e=>{$.post(sendPost("auth/login",`email=${$.email}&passwd=${$.pwd}&code=`),((n,s,t)=>{try{n?console.log(`${JSON.stringify(n)}\n登录 API 请求失败，请检查网路重试`):(t=JSON.parse(t),console.log(t.msg,"\n"))}catch(e){$.logErr(e,resp)}finally{e()}}))}))}function sendPost(e,n={}){return{url:`${$.SSPANEL_API}/${e}`,body:n,headers:{Accept:" application/json, text/javascript, */*; q=0.01","Content-type":"application/x-www-form-urlencoded; charset=UTF-8","X-requested-with":"XMLHttpRequest",Origin:`${$.SSPANEL_API}`,Referer:`${$.SSPANEL_API}`,"Accept-encoding":"gzip, deflate, br","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36"}}}accountList=accounts.indexOf("&")>-1?accounts.split("&"):[accounts],apiList=apis.indexOf("&")>-1?apis.split("&"):[apis],(async()=>{if(accounts){for(let e=0;e<accountList.length;e++)$.index=e+1,$.email=accountList[e].trim().split(",")[0],$.pwd=accountList[e].trim().split(",")[1],$.SSPANEL_API=apiList[e].trim().split("&")[0],console.log(`\n*****开始第【${$.index}】个网站****\n`),await main(),await $.wait(2e3);await sendMsg()}else console.log("请设置环境变量")})().catch((e=>{$.log("",`❌ ${$.name}, 失败! 原因: ${e}!`,"")})).finally((()=>{$.done()}));
//# sourceMappingURL=/sm/c745805ea5fd43e2256d76fc5130a35d65956e5c6d3b2b534cde0fe41385ed43.map